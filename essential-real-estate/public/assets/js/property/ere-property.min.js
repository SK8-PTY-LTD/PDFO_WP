!function(e){"use strict";e(document).ready(function(){if("undefined"!=typeof ere_property_vars){var r={};r.isMobile=/(Android|BlackBerry|iPhone|iPad|Palm|Symbian|Opera Mini|IEMobile|webOS)/.test(navigator.userAgent),r.isAndroid=/(Android)/.test(navigator.userAgent),r.isiOS=/(iPhone|iPod|iPad)/.test(navigator.userAgent),r.isiPhone=/(iPhone|iPod)/.test(navigator.userAgent),r.isiPad=/(iPad|iPod)/.test(navigator.userAgent);var o,t,a=ere_property_vars.ajax_url,i=".property-manager-form",n=ere_property_vars.ere_metabox_prefix,l=ere_property_vars.googlemap_zoom_level,s=ere_property_vars.google_map_style,d=ere_property_vars.googlemap_marker_icon,p=ere_property_vars.googlemap_default_country,c=ere_property_vars.upload_nonce,_=ere_property_vars.file_type_title,f=ere_property_vars.max_property_images,m=ere_property_vars.image_max_file_size,u=ere_property_vars.max_property_attachments,v=ere_property_vars.attachment_max_file_size,g=ere_property_vars.attachment_file_type,h=ere_property_vars.floor_name_text,y=ere_property_vars.floor_size_text,b=ere_property_vars.floor_size_postfix_text,x=ere_property_vars.floor_bedrooms_text,j=ere_property_vars.floor_bathrooms_text,w=ere_property_vars.floor_price_text,z=ere_property_vars.floor_price_postfix_text,k=ere_property_vars.floor_image_text,E=ere_property_vars.floor_description_text,A=ere_property_vars.floor_upload_text,O=e("#geocomplete"),P=function(){var r=(e('input[name="property_form"]').val(),[]);""!==s&&(r=JSON.parse(s)),O.geocomplete({map:".map_canvas",details:"form",country:p,geocodeAfterResult:!0,types:["geocode","establishment"],mapOptions:{zoom:parseInt(l),styles:r},markerOptions:{draggable:!0,icon:d}}).one("geocode:result",function(e,r){o=O.geocomplete("map"),google.maps.event.addListenerOnce(o,"idle",function(){google.maps.event.trigger(o,"resize"),t=r.geometry.location,o.setCenter(r.geometry.location)})}),O.bind("geocode:dragged",function(r,o){e("input[name=lat]").val(o.lat()),e("input[name=lng]").val(o.lng()),e("#reset").show()}),O.on("focus",function(){google.maps.event.trigger(o,"resize")}),e("#reset").on("click",function(){return O.geocomplete("resetMarker"),e("#reset").hide(),!1}),e("#find").on("click",function(e){e.preventDefault(),O.trigger("geocode")}),e(window).load(function(){O.trigger("geocode")})};P(),e('input[name="agent_display_option"]',i).on("change",function(){e('select[name="property_agent"]').hide(),"other_info"==e(this).val()?e("#property_other_contact").slideDown("slow"):e("#property_other_contact").slideUp("slow")});var S=function(){e('input[name="property_price_on_call"]').is(":checked")?(e('input[name="property_price_short"]').attr("disabled","disabled"),e('select[name="property_price_unit"]').attr("disabled","disabled"),e('input[name="property_price_prefix"]').attr("disabled","disabled"),e('input[name="property_price_postfix"]').attr("disabled","disabled")):(e('input[name="property_price_short"]').removeAttr("disabled"),e('select[name="property_price_unit"]').removeAttr("disabled"),e('input[name="property_price_prefix"]').removeAttr("disabled"),e('input[name="property_price_postfix"]').removeAttr("disabled"))};S(),e('input[name="property_price_on_call"]',i).on("change",function(){S()});var I=function(){var r=0;e("tr","#ere_additional_details").each(function(){var o=e('input[name*="additional_feature_title"]',e(this)),t=e('input[name*="additional_feature_value"]',e(this));o.attr("name","additional_feature_title["+r+"]"),o.attr("id","additional_feature_title_"+r),t.attr("name","additional_feature_value["+r+"]"),t.attr("id","additional_feature_value_"+r),r++})};e("#ere_additional_details").sortable({revert:100,placeholder:"detail-placeholder",handle:".sort-additional-row",cursor:"move",stop:function(e,r){I()}}),e(".add-additional-feature",i).on("click",function(r){r.preventDefault();var o=e(this).data("increment")+1;e(this).data("increment",o),e(this).attr({"data-increment":o});var t='<tr><td class="action-field"><span class="sort-additional-row"><i class="fa fa-navicon"></i></span></td><td><input class="form-control" type="text" name="additional_feature_title['+o+']" id="additional_feature_title_'+o+'" value=""></td><td><input class="form-control" type="text" name="additional_feature_value['+o+']" id="additional_feature_value_'+o+'" value=""></td><td><span data-remove="'+o+'" class="remove-additional-feature"><i class="fa fa-remove"></i></span></td></tr>';e("#ere_additional_details").append(t),T()});var T=function(){e(".remove-additional-feature",i).on("click",function(r){r.preventDefault();var o=e(this),t=o.closest(".additional-block"),a=t.find(".add-additional-feature"),i=parseInt(a.data("increment"))-1;o.closest("tr").remove(),a.data("increment",i),a.attr("data-increment",i),I()})};T();var M=function(){var r=0;e("tr","#ere_floors").each(function(){var o=e('label[for*="'+n+'floor_name_"]',e(this)),t=e('input[name*="'+n+'floor_name"]',e(this)),a=e('label[for*="'+n+'floor_price_"]',e(this)),i=e('input[name*="'+n+'floor_price"]',e(this)),l=e('label[for*="'+n+'floor_price_postfix_"]',e(this)),s=e('input[name*="'+n+'floor_price_postfix"]',e(this)),d=e('label[for*="'+n+'floor_size_"]',e(this)),p=e('input[name*="'+n+'floor_size"]',e(this)),c=e('label[for*="'+n+'floor_size_postfix_"]',e(this)),_=e('input[name*="'+n+'floor_size_postfix"]',e(this)),f=e('label[for*="'+n+'floor_bedrooms_"]',e(this)),m=e('input[name*="'+n+'floor_bedrooms"]',e(this)),u=e('label[for*="'+n+'floor_bathrooms_"]',e(this)),v=e('input[name*="'+n+'floor_bedrooms"]',e(this)),g=e('label[for*="'+n+'floor_image_url_"]',e(this)),h=e('input[id*="'+n+'floor_image_url"]',e(this)),y=e('input[id*="'+n+'floor_image_id"]',e(this)),b=e('button[class*="ere_floorsImg"]',e(this)),x=e('label[for*="'+n+'floor_description_"]',e(this)),j=e('input[id*="'+n+'floor_description"]',e(this));o.attr("for",n+"floor_name_"+r),t.attr("name",n+"floors["+r+"]["+n+"floor_name]"),t.attr("id",n+"floor_name_"+r),a.attr("for",n+"floor_price_"+r),i.attr("name",n+"floors["+r+"]["+n+"floor_price]"),i.attr("id",n+"floor_price_"+r),l.attr("for",n+"floor_price_postfix_"+r),s.attr("name",n+"floors["+r+"]["+n+"floor_price_postfix]"),s.attr("id",n+"floor_price_postfix_"+r),d.attr("for",n+"floor_size_"+r),p.attr("name",n+"floors["+r+"]["+n+"floor_size]"),p.attr("id",n+"floor_size_"+r),c.attr("for",n+"floor_size_postfix_"+r),_.attr("name",n+"floors["+r+"]["+n+"floor_size_postfix]"),_.attr("id",n+"floor_size_postfix_"+r),f.attr("for",n+"floor_bedrooms_"+r),m.attr("name",n+"floors["+r+"]["+n+"floor_bedrooms]"),m.attr("id",n+"floor_bedrooms_"+r),u.attr("for",n+"floor_bathrooms_"+r),v.attr("name",n+"floors["+r+"]["+n+"floor_bathrooms]"),v.attr("id",n+"floor_bathrooms_"+r),g.attr("for",n+"floor_image_url_"+r),h.attr("name",n+"floors["+r+"]["+n+"floor_image][url]"),h.attr("id",n+"floor_image_url_"+r),y.attr("name",n+"floors["+r+"]["+n+"floor_image][id]"),y.attr("id",n+"floor_image_id_"+r),b.attr("id",r),x.attr("for",n+"floor_description_"+r),j.attr("name",n+"floors["+r+"]["+n+"floor_description]"),j.attr("id",n+"floor_description_"+r),r++})};e("#ere_floors").sortable({revert:100,placeholder:"detail-placeholder",handle:".sort-floors-row",cursor:"move",stop:function(e,r){M()}});var U={},B=function(r){U["id"+r]=new plupload.Uploader({browse_button:"ere-floor-"+r,file_data_name:"property_upload_file",container:"ere-floor-plupload-container-"+r,url:a+"?action=ere_property_img_upload_ajax&nonce="+c,filters:{mime_types:[{title:_,extensions:"jpg,jpeg,gif,png"}],max_file_size:m,prevent_duplicates:!0}}),U["id"+r].init(),U["id"+r].bind("FilesAdded",function(e,o){var t=f;return e.files.length>t?(e.splice(t),void alert("no more than "+t+" file(s)")):(e.refresh(),void U["id"+r].start())}),U["id"+r].bind("Error",function(e,o){document.getElementById("ere-floor-errors-log-"+r).innerHTML+="<br/>Error #"+o.code+": "+o.message}),U["id"+r].bind("FileUploaded",function(o,t,a){var i=e.parseJSON(a.response);i.success&&(e("#ere-floor-plupload-container-"+r).find(".ere_floor_image_url").val(i.full_image),e("#ere-floor-plupload-container-"+r).find(".ere_floor_image_id").val(i.attachment_id))})};B("0");var C=function(){e(".remove-floors-row",i).on("click",function(r){r.preventDefault();var o=e(this),t=o.closest(".add-sort-table"),a=t.find("#add-floors-row"),i=parseInt(a.data("increment"))-1;o.closest("tr").remove(),a.data("increment",i),a.attr("data-increment",i),M()})};C();var L=function(){var o=e('[name="floors_enable"][checked]',".property-floors-control"),t=o.val(),a=o.closest(".property-floors-control").next(".property-floors-data");1==t?a.slideDown("slow"):0==t&&a.slideUp("slow"),e('input[name="floors_enable"]',".property-floors-control").each(function(){e(this).on("click",function(){t=e(this).val(),1==t?(a.slideDown("slow"),r.isiOS&&B("0")):0==t&&a.slideUp("slow")})})};L(),e("#add-floors-row").on("click",function(r){r.preventDefault();var o=e(this).data("increment")+1;e(this).data("increment",o),e(this).attr({"data-increment":o});var t='<tr><td class="row-sort"><span class="sort sort-floors-row"><i class="fa fa-navicon"></i></span></td><td class="sort-middle"><div class="sort-inner-block"><div class="row"><div class="col-sm-12"><div class="form-group"><label for="'+n+"floor_name_"+o+'">'+h+'</label><input name="'+n+"floors["+o+"]["+n+'floor_name]" type="text" id="'+n+"floor_name_"+o+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+n+"floor_price_"+o+'">'+w+'</label><input name="'+n+"floors["+o+"]["+n+'floor_price]" type="number" id="'+n+"floor_price_"+o+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+n+"floor_price_postfix_"+o+'">'+z+'</label><input name="'+n+"floors["+o+"]["+n+'floor_price_postfix]" type="text" id="'+n+"floor_price_postfix_"+o+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+n+"floor_size_"+o+'">'+y+'</label><input name="'+n+"floors["+o+"]["+n+'floor_size]" type="number" id="'+n+"floor_size_"+o+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+n+"floor_size_postfix_"+o+'">'+b+'</label><input name="'+n+"floors["+o+"]["+n+'floor_size_postfix]" type="text" id="'+n+"floor_size_postfix_"+o+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+n+"floor_bedrooms_"+o+'">'+x+'</label><input name="'+n+"floors["+o+"]["+n+'floor_bedrooms]" type="number" id="'+n+"floor_bedrooms_"+o+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+n+"floor_bathrooms_"+o+'">'+j+'</label><input name="'+n+"floors["+o+"]["+n+'floor_bathrooms]" type="number" id="'+n+"floor_bathrooms_"+o+'" class="form-control"></div></div><div class="col-sm-6"><div class="form-group"><label for="'+n+"floor_image_url_"+o+'">'+k+'</label><div id="ere-floor-plupload-container-'+o+'" class="file-upload-block"><input name="'+n+"floors["+o+"]["+n+'floor_image][url]" type="text" id="'+n+"floor_image_url_"+o+'" class="ere_floor_image_url form-control"><input name="'+n+"floors["+o+"]["+n+'floor_image][id]" type="hidden" id="'+n+"floor_image_id_"+o+'" class="ere_floor_image_id"><button type="button" id="ere-floor-'+o+'" style="position: absolute" title="'+A+'" class="ere_floorsImg"><i class="fa fa-file-image-o"></i></button></div><div id="ere-floor-errors-log"></div></div></div><div class="col-sm-6"><div class="form-group"><label for="'+n+"floor_description_"+o+'">'+E+'</label><textarea name="'+n+"floors["+o+"]["+n+'floor_description]" rows="4" id="'+n+"floor_description_"+o+'" class="form-control"></textarea></div></div></div></div></td><td class="row-remove"><span data-remove="'+o+'" class="remove-floors-row remove"><i class="fa fa-remove"></i></span></td></tr>';e("#ere_floors").append(t),C(),B(o)});var H=function(){e(".icon-featured",".ere-property-gallery").on("click",function(){var r=e(this),o=r.data("attachment-id"),t=r.find("i");e(".media-thumb .featured-image-id").remove(),e(".media-thumb .icon-featured i").removeClass("fa-star").addClass("fa-star-o"),r.closest(".media-thumb").append('<input type="hidden" class="featured-image-id" name="featured_image_id" value="'+o+'">'),t.removeClass("fa-star-o").addClass("fa-star")}),e(".icon-delete",".ere-property-gallery").on("click",function(){var r=e(this),o=r.children("i"),t=r.closest(".media-thumb-wrap"),i=r.data("property-id"),n=r.data("attachment-id");o.addClass("fa-spinner fa-spin"),e.ajax({type:"post",url:a,dataType:"json",data:{action:"ere_remove_property_attachment_ajax",property_id:i,attachment_id:n,type:"gallery",removeNonce:c},success:function(e){e.success&&(t.remove(),t.hide()),o.removeClass("fa-spinner fa-spin")},error:function(){o.removeClass("fa-spinner fa-spin")}})})};H();var D=function(){e(".icon-delete",".ere-property-attachments").on("click",function(){var r=e(this),o=r.children("i"),t=r.closest(".media-thumb-wrap"),i=r.data("property-id"),n=r.data("attachment-id");o.addClass("fa-spinner fa-spin"),e.ajax({type:"post",url:a,dataType:"json",data:{action:"ere_remove_property_attachment_ajax",property_id:i,attachment_id:n,type:"attachments",removeNonce:c},success:function(e){e.success&&(t.remove(),t.hide()),o.removeClass("fa-spinner fa-spin")},error:function(){o.removeClass("fa-spinner fa-spin")}})})};D();var F=function(){e("#property_gallery_thumbs_container").sortable();var r=new plupload.Uploader({browse_button:"ere_select_gallery_images",file_data_name:"property_upload_file",container:"ere_gallery_plupload_container",drop_element:"ere_gallery_plupload_container",multi_selection:!0,url:a+"?action=ere_property_img_upload_ajax&nonce="+c,filters:{mime_types:[{title:_,extensions:"jpg,jpeg,gif,png"}],max_file_size:m,prevent_duplicates:!0}});r.init(),r.bind("FilesAdded",function(e,o){var t="",a=f;return e.files.length>a?(e.splice(a),void alert("no more than "+a+" file(s)")):(plupload.each(o,function(e){t+='<div id="holder-'+e.id+'" class="col-sm-2 media-thumb-wrap"></div>'}),document.getElementById("property_gallery_thumbs_container").innerHTML+=t,e.refresh(),void r.start())}),r.bind("UploadProgress",function(e,r){document.getElementById("holder-"+r.id).innerHTML='<span><i class="fa fa-spinner fa-spin"></i></span>'}),r.bind("Error",function(e,r){document.getElementById("ere_gallery_errors_log").innerHTML+="<br/>Error #"+r.code+": "+r.message}),r.bind("FileUploaded",function(r,o,t){var a=e.parseJSON(t.response);if(a.success){var i='<figure class="media-thumb"><img src="'+a.url+'" alt="" /><div class="media-item-actions"><a class="icon icon-delete" data-property-id="0"  data-attachment-id="'+a.attachment_id+'" href="javascript:;" ><i class="fa fa-trash-o"></i></a><a class="icon icon-featured" data-property-id="0"  data-attachment-id="'+a.attachment_id+'" href="javascript:;" ><i class="fa fa-star-o"></i></a><input type="hidden" class="property_image_ids" name="property_image_ids[]" value="'+a.attachment_id+'"/><span style="display: none;" class="icon icon-loader"><i class="fa fa-spinner fa-spin"></i></span></div></figure>';document.getElementById("holder-"+o.id).innerHTML=i,H()}})};F();var N=function(){e("#property_attachments_thumbs_container").sortable();var r=new plupload.Uploader({browse_button:"ere_select_file_attachments",file_data_name:"property_upload_file",container:"ere_attachments_plupload_container",drop_element:"ere_attachments_plupload_container",multi_selection:!0,url:a+"?action=ere_property_attachment_upload_ajax&nonce="+c,filters:{mime_types:[{title:_,extensions:g}],max_file_size:v,prevent_duplicates:!0}});r.init(),r.bind("FilesAdded",function(e,o){var t="",a=u;return e.files.length>a?(e.splice(a),void alert("no more than "+a+" file(s)")):(plupload.each(o,function(e){t+='<div id="holder-'+e.id+'" class="col-lg-4 col-md-4 col-sm-6 col-xs-12 media-thumb-wrap"></div>'}),document.getElementById("property_attachments_thumbs_container").innerHTML+=t,e.refresh(),void r.start())}),r.bind("UploadProgress",function(e,r){document.getElementById("holder-"+r.id).innerHTML='<span><i class="fa fa-spinner fa-spin"></i></span>'}),r.bind("Error",function(e,r){document.getElementById("ere_attachments_errors_log").innerHTML+="<br/>Error #"+r.code+": "+r.message}),r.bind("FileUploaded",function(r,o,t){var a=e.parseJSON(t.response);if(a.success){var i='<figure class="media-thumb"><img src="'+a.thumb_url+'" alt="" /><a href="'+a.url+'">'+a.file_name+'</a><div class="media-item-actions"><a class="icon icon-delete" data-property-id="0"  data-attachment-id="'+a.attachment_id+'" href="javascript:;" ><i class="fa fa-trash-o"></i></a><input type="hidden" class="property_attachment_ids" name="property_attachment_ids[]" value="'+a.attachment_id+'"/><span style="display: none;" class="icon icon-loader"><i class="fa fa-spinner fa-spin"></i></span></div></figure>';document.getElementById("holder-"+o.id).innerHTML=i,D()}})};N();var J=function(){var r=new plupload.Uploader({browse_button:"ere_select_images_360",file_data_name:"property_upload_file",container:"ere_image_360_plupload_container",url:a+"?action=ere_property_img_upload_ajax&nonce="+c,filters:{mime_types:[{title:_,extensions:"jpg,jpeg,gif,png"}],max_file_size:m,prevent_duplicates:!0}});r.init(),r.bind("FilesAdded",function(e,o){var t=f;return e.files.length>t?(e.splice(t),void alert("no more than "+t+" file(s)")):(plupload.each(o,function(e){}),e.refresh(),void r.start())}),r.bind("Error",function(e,r){document.getElementById("ere_image_360_errors_log").innerHTML+="<br/>Error #"+r.code+": "+r.message}),r.bind("FileUploaded",function(r,o,t){var a=e.parseJSON(t.response);if(a.success){e(".ere_image_360_url").val(a.full_image),e(".ere_image_360_id").val(a.attachment_id);var i=e("#ere_property_image_360_view").attr("data-plugin-url"),n='<iframe width="100%" height="200" scrolling="no" allowfullscreen src="'+i+"public/assets/packages/vr-view/index.html?image="+a.full_image+'"></iframe>';e("#ere_property_image_360_view").html(n)}})};J();var Q=function(){var r=e(".ere-property-country-ajax",i);if(r.length){var o=r.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_states_by_country_ajax",country:o,type:0},beforeSend:function(){r.parent().children(".ere-loading").remove(),r.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(o){e(".ere-property-state-ajax",i).html(o);var t=e(".ere-property-state-ajax",i).attr("data-selected");"undefined"!=t&&e(".ere-property-state-ajax",i).val(t),r.parent().children(".ere-loading").remove()},error:function(){r.parent().children(".ere-loading").remove()},complete:function(){r.parent().children(".ere-loading").remove()}})}};Q(),e(".ere-property-country-ajax",i).on("change",function(){Q()});var R=function(){var r=e(".ere-property-state-ajax",i);if(r.length){var o=r.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_cities_by_state_ajax",state:o,type:0},beforeSend:function(){r.parent().children(".ere-loading").remove(),r.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(o){e(".ere-property-city-ajax",i).html(o);var t=e(".ere-property-city-ajax",i).attr("data-selected");"undefined"!=t&&e(".ere-property-city-ajax",i).val(t),r.parent().children(".ere-loading").remove()},error:function(){r.parent().children(".ere-loading").remove()},complete:function(){r.parent().children(".ere-loading").remove()}})}};R(),e(".ere-property-state-ajax",i).on("change",function(){R()});var q=function(){var r=e(".ere-property-city-ajax",i);if(r.length){var o=r.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_neighborhoods_by_city_ajax",city:o,type:0},beforeSend:function(){r.parent().children(".ere-loading").remove(),r.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>')},success:function(o){e(".ere-property-neighborhood-ajax",i).html(o);var t=e(".ere-property-neighborhood-ajax",i).attr("data-selected");"undefined"!=t&&e(".ere-property-neighborhood-ajax",i).val(t),r.parent().children(".ere-loading").remove()},error:function(){r.parent().children(".ere-loading").remove()},complete:function(){r.parent().children(".ere-loading").remove()}})}};q(),e(".ere-property-city-ajax",i).on("change",function(){q()});var G=e(".ere-property-multi-step");G.find(".ere-btn-next").on("click",function(){r.isiOS&&(F(),N(),J(),B("0")),"false"===e("#step-location").attr("aria-hidden")&&"undefined"!=typeof O&&O.trigger("geocode")}),G.find(".ere-btn-edit").on("click",function(){r.isiOS&&(F(),N(),J(),B("0")),"false"===e("#step-location").attr("aria-hidden")&&"undefined"!=typeof O&&O.trigger("geocode")})}})}(jQuery);