var ERE_Property_Map_Search=ERE_Property_Map_Search||{};!function(e){"use strict";var a=ere_search_vars.ajax_url,t=ere_search_vars.price_is_slider,r=".ere-search-properties-map";ERE_Property_Map_Search={init:function(){this.full_screen(),this.get_states_by_country(),e(".ere-property-country-ajax",r).on("change",function(){ERE_Property_Map_Search.get_states_by_country()}),this.get_cities_by_state(),e(".ere-property-state-ajax",r).on("change",function(){ERE_Property_Map_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),e(".ere-property-city-ajax",r).on("change",function(){ERE_Property_Map_Search.get_neighborhoods_by_city()}),e(".btn-status-filter",r).on("click",function(a){a.preventDefault();var t=e(this).data("value");e(this).parent().find("input").val(t),e(this).parent().find("button").removeClass("active"),e(this).addClass("active"),ERE_Property_Map_Search.change_price_on_status_change(t)}),e('select[name="status"]',r).on("change",function(a){a.preventDefault();var t=e(this).val();ERE_Property_Map_Search.change_price_on_status_change(t)}),this.execute_url_search(),e(".ere-sliderbar-filter.ere-sliderbar-price",r).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",r).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})}),this.register_slider_filter(),this.set_slider_value(),e(".other-features-wrap .btn-other-features",r).on("click",function(a){a.preventDefault(),e(".other-features-list",r).slideToggle(),e(this).toggleClass("show"),1==e(this).hasClass("show")?(e('input[name="features-search"]',r).attr("value","1"),e(this).find("i").removeClass("fa-chevron-down"),e(this).find("i").addClass("fa-chevron-up")):(e('input[name="features-search"]',r).attr("value","0"),e(this).find("i").removeClass("fa-chevron-up"),e(this).find("i").addClass("fa-chevron-down")),ERE_Property_Map_Search.search_on_change()}),e(".ere-sliderbar-filter.ere-sliderbar-price",r).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",r).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})}),e(".ere-search-status-tab .btn-status-filter",r).on("click",function(){e(this).parent().find("input").val(e(this).data("value")),e(this).parent().find("button").removeClass("active"),e(this).addClass("active")}),e('select[name="type"], select[name="bedrooms"],select[name="bathrooms"] , select[name="garage"], select[name="label"],input[name="address"],input[name="title"],input[name="property_identity"], select[name="min-price"], select[name="max-price"],select[name="min-area"], select[name="max-area"],select[name="min-land-area"], select[name="min-land-area"], select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"]',r).on("change",function(){ERE_Property_Map_Search.search_on_change()}),e('input[name="other_features"]',r).on("change",function(){ERE_Property_Map_Search.search_on_change()}),ERE_Property_Map_Search.search_properties("map_only")},get_states_by_country:function(){var t=e(".ere-property-country-ajax",r);if(t.length){var i=t.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_states_by_country_ajax",country:i,type:1},success:function(a){e(".ere-property-state-ajax",r).html(a);var t=e(".ere-property-state-ajax",r).attr("data-selected");"undefined"!=t&&e(".ere-property-state-ajax",r).val(t)}})}},get_cities_by_state:function(){var t=e(".ere-property-state-ajax",r);if(t.length){var i=t.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_cities_by_state_ajax",state:i,type:1},success:function(a){e(".ere-property-city-ajax",r).html(a);var t=e(".ere-property-city-ajax",r).attr("data-selected");"undefined"!=t&&e(".ere-property-city-ajax",r).val(t)}})}},get_neighborhoods_by_city:function(){var t=e(".ere-property-city-ajax",r);if(t.length){var i=t.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_neighborhoods_by_city_ajax",city:i,type:1},success:function(a){e(".ere-property-neighborhood-ajax",r).html(a);var t=e(".ere-property-neighborhood-ajax",r).attr("data-selected");"undefined"!=t&&e(".ere-property-neighborhood-ajax",r).val(t)}})}},execute_url_search:function(){e(".ere-advanced-search-btn",r).on("click",function(a){a.preventDefault();var t=e(this).closest(".search-properties-form"),r=t.data("href"),i=[],n="?";if(-1!==r.indexOf("?")&&(n="&"),e(".search-field",t).each(function(){var a=e(this),t=a.attr("name"),r=a.val(),n=a.data("default-value");r!=n&&(i[t]=r)}),e(".ere-sliderbar-filter",t).each(function(){var a=e(this),t=a.find(".min-input-request").attr("name"),r=a.find(".max-input-request").attr("name"),n=a.find(".min-input-request").val(),s=a.find(".max-input-request").val(),o=a.data("min-default"),l=a.data("max-default");(n!=o||s!=l)&&(i[t]=n,i[r]=s)}),"undefined"!=typeof i["features-search"]){var s="";e('[name="other_features"]',t).each(function(){var a=e(this),t=a.attr("value");a.is(":checked")&&(s+=t+";")}),""!==s&&(s=s.substring("0",s.length-1),i.other_features=s)}if(i!==[])for(var o in i)i.hasOwnProperty(o)&&(n+=o+"="+i[o]+"&");n=n.substring("0",n.length-1),window.location.href=r+n})},set_slider_filter:function(e){var a,t,r=e,i=parseInt(r.attr("data-min-default")),n=parseInt(r.attr("data-max-default")),s=r.attr("data-min"),o=r.attr("data-max"),l=r.find(".sidebar-filter");l.slider({min:i,max:n,range:!0,values:[s,o],slide:function(e,i){a=i.values[0],t=i.values[1],r.attr("data-min",a),r.attr("data-max",t),r.find("input.min-input-request").attr("value",a),r.find("input.max-input-request").attr("value",t),r.find("span").hasClass("not-format")?(r.find("span.min-value").html(a),r.find("span.max-value").html(t)):(r.find("span.min-value:not(.not-format)").html(ERE.number_format(a)),r.find("span.max-value:not(.not-format)").html(ERE.number_format(t)))},stop:function(e,a){ERE_Property_Map_Search.search_on_change()}})},register_slider_filter:function(){e(".ere-sliderbar-filter",r).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})},set_slider_value:function(){e(".ere-sliderbar-filter",r).each(function(){var a=e(this),t=a.attr("data-min-default"),r=a.attr("data-max-default"),i=a.attr("data-min"),n=a.attr("data-max"),s=(i-t)/(r-t)*100+"%",o=(n-i)/(r-t)*100+"%",l=(n-t)/(r-t)*100+"%";a.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:s,width:o}),a.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",s),a.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",l)})},change_price_on_status_change:function(i){e.ajax({type:"POST",url:a,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:i,price_is_slider:t},success:function(a){a.slide_html?(e(".ere-sliderbar-price-wrap",r).html(a.slide_html),ERE_Property_Map_Search.register_slider_filter(),ERE_Property_Map_Search.set_slider_value()):(a.min_price_html&&e('select[name="min-price"]',r).html(a.min_price_html),a.max_price_html&&e('select[name="max-price"]',r).html(a.max_price_html)),ERE_Property_Map_Search.search_on_change()}})},full_screen:function(){if(e(".ere-search-properties-map.style-vertical").length>0){var a=e(window).outerHeight(),t=e("#wpadminbar").outerHeight();null==t&&(t=0);var r=e("header").outerHeight(),i=e("footer").outerHeight(),n=e(".wpadminbar").outerHeight(),s=a-t-r-i-n;e(".ere-search-properties-map.style-vertical .ere-map-search").css("height",s),e(".ere-search-properties-map.style-vertical .ere-map-search .ere-map-result").css("height",s),e(".col-scroll-vertical").css({height:s,"overflow-y":"scroll","overflow-x":"hidden"});var o=e(".owl-carousel",".list-property-result-ajax"),l=e(".property-item",o);o.trigger("destroy.owl.carousel"),o.css("opacity",1),o.imagesLoaded(function(){ERE.set_item_effect(l,"hide"),ERE_Carousel.owlCarousel(),l=e(".property-item",o),ERE.set_item_effect(l,"show")})}},search_on_change:function(){var a="map_only";e(".list-property-result-ajax",r).length>0&&(a="map_and_content"),ERE_Property_Map_Search.search_properties(a)},search_properties:function(t){var i,n,s,o,l,c,d,p,u,_,h,f,m,g,v,y,b,x,E,w,P,R=e(r);l=R.find('input[name="title"]').val(),g=R.find('input[name="address"]').val(),n=R.find('select[name="city"]').val(),d=R.find('select[name="type"]').val(),c=R.find('select[name="status"]').val(),void 0==c&&(c=R.find('input[name="status"]').val()),p=R.find('select[name="bedrooms"]').val(),u=R.find('select[name="bathrooms"]').val(),e(".ere-sliderbar-price",R).length?(_=R.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-min"),h=R.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-max")):(_=R.find('select[name="min-price"]').val(),h=R.find('select[name="max-price"]').val()),e(".ere-sliderbar-area",R).length?(f=R.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-min"),m=R.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-max")):(f=R.find('select[name="min-area"]').val(),m=R.find('select[name="max-area"]').val()),e(".ere-sliderbar-land-area",R).length?(x=R.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-min"),E=R.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-max")):(x=R.find('select[name="min-land-area"]').val(),E=R.find('select[name="max-land-area"]').val()),s=R.find('select[name="state"]').val(),i=R.find('select[name="country"]').val(),o=R.find('select[name="neighborhood"]').val(),b=R.find('select[name="label"]').val(),v=R.find('select[name="garage"]').val(),w=R.find('input[name="property_identity"]').val(),P=R.find('input[name="features-search"]').val(),"1"==P&&(y="",R.find(".other-features-list input[type=checkbox]:checked").each(function(){y+=e(this).val()+";"}),""!=y&&(y=y.substring(0,y.length-1)));var S,j=e("#ere_security_search_map").val(),M=e(R).find(".ere-map-result").attr("id"),C=e("#"+M),k=[],L=null,O=ere_search_vars.googlemap_default_zoom,T=ere_search_vars.not_found,I=ere_search_vars.clusterIcon,z=ere_search_vars.google_map_style,B=ere_search_vars.pin_cluster_enable,H=!0;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(H=!1);var q={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scrollwheel:!1,scroll:{x:e(window).scrollLeft(),y:e(window).scrollTop()},zoom:parseInt(O),mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:H,fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}},A=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1}),D=function(a,t){e.each(a,function(e,a){var r=new google.maps.LatLng(a.lat,a.lng),i=a.marker_icon,n=new google.maps.Size(44,60),s={url:i,size:n,scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(22,60)},o=new google.maps.Marker({position:r,map:t,icon:s,draggable:!1,animation:google.maps.Animation.DROP}),l=a.data?a.data.post_title:a.title,c="";(""==a.image_url||"undefined"==typeof a.image_url)&&(c='style="display: none;"');var d=document.createElement("div");d.className="marker-content clearfix",d.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+c+'><a href="'+a.url+'"><img src="'+a.image_url+'" alt="'+l+'" style="width: 100px;"></a></div><div class="item-body"><a href="'+a.url+'" class="title-marker">'+l+'</a><div class="price-marker">'+a.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+a.address+"</div></div></div>",google.maps.event.addListener(o,"click",function(e,a){return function(){var a=Math.pow(2,t.getZoom()),r=100/a||0,i=t.getProjection(),n=e.getPosition(),s=i.fromLatLngToPoint(n),o=new google.maps.Point(s.x,s.y-r),l=i.fromPointToLatLng(o);t.setCenter(l),setTimeout(function(){A.setContent(d),A.open(t,e)},300)}}(o,e)),k.push(o)})};e.ajax({dataType:"json",url:a,data:{action:"ere_property_search_ajax",title:l,address:g,country:i,state:s,city:n,neighborhood:o,type:d,status:c,bedrooms:p,bathrooms:u,min_price:_,max_price:h,min_area:f,max_area:m,label:b,garage:v,min_land_area:x,max_land_area:E,property_identity:w,features:y,search_type:t,ere_security_search_map:j},beforeSend:function(){C.parents("div.ere-search-properties-map").find("#ere-map-loading").fadeIn()},success:function(a){if("map_and_content"==t){var r=e(".owl-carousel",".list-property-result-ajax"),i=e(".list-property-result-ajax");if(r.empty(),a.success===!1)i.find(".title-result h2 .number-result").hide(),i.find(".title-result h2 .text-no-result").show(),i.find(".title-result h2 .text-result").hide();else{var n=e(".property-item",a.property_html);r.css("opacity",0),r.trigger("destroy.owl.carousel"),r.html(n),r.css("opacity",1),r.imagesLoaded(function(){ERE.set_item_effect(n,"hide"),ERE_Carousel.owlCarousel(),n=e(".property-item",r),ERE.set_item_effect(n,"show")}),"0"!=n.length&&(i.find(".title-result h2 .number-result").html(n.length),i.find(".title-result h2 .number-result").show(),i.find(".title-result h2 .text-no-result").hide(),i.find(".title-result h2 .text-result").show())}ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}if(S=new google.maps.Map(document.getElementById(M),q),S.set("scrollwheel",!1),google.maps.event.trigger(S,"resize"),a.success===!0&&a.properties)var s=a.properties.length;if(1==s)var o=google.maps.event.addListener(S,"bounds_changed",function(e){this.setZoom(parseInt(O)),google.maps.event.removeListener(o)});if(""!==z){var l=JSON.parse(z);S.setOptions({styles:l})}var c=new google.maps.LatLng("","");if(S.setCenter(c),S.setZoom(parseInt(O)),google.maps.event.addListener(S,"tilesloaded",function(){e("#ere-map-loading").fadeOut()}),a.success===!0){for(var d=0;d<k.length;d++)k[d].setMap(null);k=[],D(a.properties,S),S.fitBounds(k.reduce(function(e,a){return e.extend(a.getPosition())},new google.maps.LatLngBounds)),google.maps.event.trigger(S,"resize"),"1"==B&&(L=new MarkerClusterer(S,k,{gridSize:60,styles:[{url:I,width:48,height:48,textColor:"#fff"}]}))}else C.empty().html('<div class="map-notfound">'+T+"</div>");C.closest("div.ere-search-properties-map").find("#ere-map-loading").fadeOut("slow")},error:function(){C.closest("div.ere-search-properties-map").find("#ere-map-loading").fadeOut("slow")}})}},e(document).ready(function(){ERE_Property_Map_Search.init()}),e(window).resize(function(){ERE_Property_Map_Search.full_screen()}),e(window).on("orientationchange",function(){ERE_Property_Map_Search.full_screen()})}(jQuery);