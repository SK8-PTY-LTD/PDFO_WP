var ERE_Property_Map_Search=ERE_Property_Map_Search||{};!function(e){"use strict";var a=ere_search_map_vars.ajax_url,t=ere_search_map_vars.price_is_slider,r=ere_search_map_vars.item_amount,i=".ere-search-map-properties",n=!0;ERE_Property_Map_Search={init:function(){this.full_screen(),this.get_states_by_country(),e(".ere-property-country-ajax",i).on("change",function(){ERE_Property_Map_Search.get_states_by_country()}),this.get_cities_by_state(),e(".ere-property-state-ajax",i).on("change",function(){ERE_Property_Map_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),e(".ere-property-city-ajax",i).on("change",function(){ERE_Property_Map_Search.get_neighborhoods_by_city()}),e(".btn-status-filter",i).on("click",function(a){a.preventDefault();var t=e(this).data("value");e(this).parent().find("input").val(t),e(this).parent().find("button").removeClass("active"),e(this).addClass("active"),ERE_Property_Map_Search.change_price_on_status_change(t)}),e('select[name="status"]',i).on("change",function(a){a.preventDefault();var t=e(this).val();ERE_Property_Map_Search.change_price_on_status_change(t)}),this.execute_url_search(),e(".ere-sliderbar-filter.ere-sliderbar-price",i).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",i).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})}),this.register_slider_filter(),this.set_slider_value(),this.property_map_paging(),this.search_map("map_only"),e(".other-features-wrap .btn-other-features",i).on("click",function(a){a.preventDefault(),e(".other-features-list",i).slideToggle(),e(this).toggleClass("show"),1==e(this).hasClass("show")?(e('input[name="features-search"]',i).attr("value","1"),e(this).find("i").removeClass("fa-chevron-down"),e(this).find("i").addClass("fa-chevron-up")):(e('input[name="features-search"]',i).attr("value","0"),e(this).find("i").removeClass("fa-chevron-up"),e(this).find("i").addClass("fa-chevron-down")),ERE_Property_Map_Search.search_map("map_and_content")}),e(".ere-sliderbar-filter.ere-sliderbar-price",i).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",i).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})}),e(".ere-search-status-tab .btn-status-filter",i).on("click",function(){e(this).parent().find("input").val(e(this).data("value")),e(this).parent().find("button").removeClass("active"),e(this).addClass("active")}),e('select[name="type"], select[name="bedrooms"],select[name="bathrooms"] , select[name="garage"], select[name="label"],input[name="address"],input[name="title"],input[name="property_identity"], select[name="min-price"], select[name="max-price"],select[name="min-area"], select[name="max-area"],select[name="min-land-area"], select[name="min-land-area"], select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"]',i).on("change",function(){ERE_Property_Map_Search.search_map("map_and_content")}),e('input[name="other_features"]',i).on("change",function(){ERE_Property_Map_Search.search_map("map_and_content")})},get_states_by_country:function(){var t=e(".ere-property-country-ajax",i);if(t.length){var r=t.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_states_by_country_ajax",country:r,type:1},success:function(a){e(".ere-property-state-ajax",i).html(a);var t=e(".ere-property-state-ajax",i).attr("data-selected");"undefined"!=t&&e(".ere-property-state-ajax",i).val(t)}})}},get_cities_by_state:function(){var t=e(".ere-property-state-ajax",i);if(t.length){var r=t.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_cities_by_state_ajax",state:r,type:1},success:function(a){e(".ere-property-city-ajax",i).html(a);var t=e(".ere-property-city-ajax",i).attr("data-selected");"undefined"!=t&&e(".ere-property-city-ajax",i).val(t)}})}},get_neighborhoods_by_city:function(){var t=e(".ere-property-city-ajax",i);if(t.length){var r=t.val();e.ajax({type:"POST",url:a,data:{action:"ere_get_neighborhoods_by_city_ajax",city:r,type:1},success:function(a){e(".ere-property-neighborhood-ajax",i).html(a);var t=e(".ere-property-neighborhood-ajax",i).attr("data-selected");"undefined"!=t&&e(".ere-property-neighborhood-ajax",i).val(t)}})}},execute_url_search:function(){e(".ere-advanced-search-btn",i).on("click",function(a){a.preventDefault();var t=e(this).closest(".search-properties-form"),r=t.data("href"),i=[],n="?";if(-1!==r.indexOf("?")&&(n="&"),e(".search-field",t).each(function(){var a=e(this),t=a.attr("name"),r=a.val(),n=a.data("default-value");r!=n&&(i[t]=r)}),e(".ere-sliderbar-filter",t).each(function(){var a=e(this),t=a.find(".min-input-request").attr("name"),r=a.find(".max-input-request").attr("name"),n=a.find(".min-input-request").val(),s=a.find(".max-input-request").val(),o=a.data("min-default"),l=a.data("max-default");(n!=o||s!=l)&&(i[t]=n,i[r]=s)}),"undefined"!=typeof i["features-search"]){var s="";e('[name="other_features"]',t).each(function(){var a=e(this),t=a.attr("value");a.is(":checked")&&(s+=t+";")}),""!==s&&(s=s.substring("0",s.length-1),i.other_features=s)}if(i!==[])for(var o in i)i.hasOwnProperty(o)&&(n+=o+"="+i[o]+"&");n=n.substring("0",n.length-1),window.location.href=r+n})},set_slider_filter:function(e){var a,t,r=e,i=parseInt(r.attr("data-min-default")),n=parseInt(r.attr("data-max-default")),s=r.attr("data-min"),o=r.attr("data-max"),l=r.find(".sidebar-filter");l.slider({min:i,max:n,range:!0,values:[s,o],slide:function(e,i){a=i.values[0],t=i.values[1],r.attr("data-min",a),r.attr("data-max",t),r.find("input.min-input-request").attr("value",a),r.find("input.max-input-request").attr("value",t),r.find("span").hasClass("not-format")?(r.find("span.min-value").html(a),r.find("span.max-value").html(t)):(r.find("span.min-value:not(.not-format)").html(ERE.number_format(a)),r.find("span.max-value:not(.not-format)").html(ERE.number_format(t)))},stop:function(e,a){ERE_Property_Map_Search.search_map("map_and_content")}})},register_slider_filter:function(){e(".ere-sliderbar-filter",i).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})},set_slider_value:function(){e(".ere-sliderbar-filter",i).each(function(){var a=e(this),t=a.attr("data-min-default"),r=a.attr("data-max-default"),i=a.attr("data-min"),n=a.attr("data-max"),s=(i-t)/(r-t)*100+"%",o=(n-i)/(r-t)*100+"%",l=(n-t)/(r-t)*100+"%";a.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:s,width:o}),a.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",s),a.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",l)})},change_price_on_status_change:function(r){e.ajax({type:"POST",url:a,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:r,price_is_slider:t},success:function(a){a.slide_html?(e(".ere-sliderbar-price-wrap",i).html(a.slide_html),ERE_Property_Map_Search.register_slider_filter(),ERE_Property_Map_Search.set_slider_value()):(a.min_price_html&&e('select[name="min-price"]',i).html(a.min_price_html),a.max_price_html&&e('select[name="max-price"]',i).html(a.max_price_html)),ERE_Property_Map_Search.search_map("map_and_content")}})},full_screen:function(){if(e(".ere-search-map-properties").length>0){var a=e(window).outerHeight(),t=e("#wpadminbar").outerHeight();null==t&&(t=0);var r=e("header").outerHeight(),i=e("footer").outerHeight(),n=e(".wpadminbar").outerHeight(),s=a-t-r-i-n;e(".ere-search-map-properties .ere-map-search").css("height",s),e(".ere-search-map-properties .ere-map-search .ere-map-result").css("height",s),e(".col-scroll-vertical").css({height:s,"overflow-y":"scroll","overflow-x":"hidden"});var o=e(".property-vertical-map-listing",".list-property-result-ajax"),l=e(".property-item",o);o.css("opacity",1),o.imagesLoaded(function(){ERE.set_item_effect(l,"hide"),l=e(".property-item",o),ERE.set_item_effect(l,"show")})}},property_map_paging:function(){n=!0,e(".paging-navigation",".property-search-map-paging-wrap").each(function(){e("a",e(this)).button({loadingText:'<span class="fa fa-spinner fa-spin"></span>'}),e("a",e(this)).off("click").on("click",function(a){a.preventDefault();var t=e(this);ERE_Property_Map_Search.search_map("map_and_content",t)})})},property_map_paging_control:function(){e(".paging-navigation",".property-search-map-paging-wrap").each(function(){var a=e(this);0===a.find("a.next").length?a.addClass("next-disable"):a.removeClass("next-disable")})},search_map:function(t,s){var o,l,c,p,d,_,h,m,u,f,g,v,y,b,x,E,w,P,R,S,M,j=e(i),C=j.find(".ere-map-result").attr("id");d=j.find('input[name="title"]').val(),b=j.find('input[name="address"]').val(),l=j.find('select[name="city"]').val(),h=j.find('select[name="type"]').val(),_=j.find('select[name="status"]').val(),void 0==_&&(_=j.find('input[name="status"]').val()),m=j.find('select[name="bedrooms"]').val(),u=j.find('select[name="bathrooms"]').val(),e(".ere-sliderbar-price",j).length?(f=j.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-min"),g=j.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-max")):(f=j.find('select[name="min-price"]').val(),g=j.find('select[name="max-price"]').val()),e(".ere-sliderbar-area",j).length?(v=j.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-min"),y=j.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-max")):(v=j.find('select[name="min-area"]').val(),y=j.find('select[name="max-area"]').val()),e(".ere-sliderbar-land-area",j).length?(P=j.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-min"),R=j.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-max")):(P=j.find('select[name="min-land-area"]').val(),R=j.find('select[name="max-land-area"]').val()),c=j.find('select[name="state"]').val(),o=j.find('select[name="country"]').val(),p=j.find('select[name="neighborhood"]').val(),w=j.find('select[name="label"]').val(),x=j.find('select[name="garage"]').val(),S=j.find('input[name="property_identity"]').val(),M=j.find('input[name="features-search"]').val(),"1"==M&&(E="",j.find(".other-features-list input[type=checkbox]:checked").each(function(){E+=e(this).val()+";"}),""!=E&&(E=E.substring(0,E.length-1)));var T,k=e("#ere_security_search_map").val(),L=e("#"+C),O=[],I=null,z=ere_search_map_vars.googlemap_default_zoom,H=ere_search_map_vars.not_found,B=ere_search_map_vars.clusterIcon,D=ere_search_map_vars.google_map_style,q=ere_search_map_vars.pin_cluster_enable,A=!0;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(A=!1);var N={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scrollwheel:!1,scroll:{x:e(window).scrollLeft(),y:e(window).scrollTop()},zoom:parseInt(z),mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:A,fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}},Z=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1}),G=function(a,t){e.each(a,function(e,a){var r=new google.maps.LatLng(a.lat,a.lng),i=a.marker_icon,n=new google.maps.Size(44,60),s={url:i,size:n,scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(22,60)},o=new google.maps.Marker({position:r,map:t,icon:s,draggable:!1,animation:google.maps.Animation.DROP}),l=a.data?a.data.post_title:a.title,c="";(""==a.image_url||"undefined"==typeof a.image_url)&&(c='style="display: none;"');var p=document.createElement("div");p.className="marker-content clearfix",p.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+c+'><a href="'+a.url+'"><img src="'+a.image_url+'" alt="'+l+'" style="width: 100px;"></a></div><div class="item-body"><a href="'+a.url+'" class="title-marker">'+l+'</a><div class="price-marker">'+a.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+a.address+"</div></div></div>",google.maps.event.addListener(o,"click",function(e,a){return function(){var a=Math.pow(2,t.getZoom()),r=100/a||0,i=t.getProjection(),n=e.getPosition(),s=i.fromLatLngToPoint(n),o=new google.maps.Point(s.x,s.y-r),l=i.fromPointToLatLng(o);t.setCenter(l),setTimeout(function(){Z.setContent(p),Z.open(t,e)},300)}}(o,e)),O.push(o)})},W=1;if(void 0!=s){s.css({padding:"0px",height:s.outerHeight(),width:s.outerWidth()}),s.button("loading");var J=s.attr("href");W=ERE.get_page_number_from_href(J)}e.ajax({dataType:"json",url:a,data:{action:"ere_property_search_map_ajax",title:d,address:b,country:o,state:c,city:l,neighborhood:p,type:h,status:_,bedrooms:m,bathrooms:u,min_price:f,max_price:g,min_area:v,max_area:y,label:w,garage:x,min_land_area:P,max_land_area:R,property_identity:S,features:E,search_type:t,paged:W,item_amount:r,ere_security_search_map:k},beforeSend:function(){L.parents("div.ere-search-map-properties").find("#ere-map-loading").fadeIn()},success:function(a){if("map_and_content"==t){var r=e(".property-vertical-map-listing"),i=e(".list-property-result-ajax");if(a.success===!1)i.find(".title-result h2 .number-result").hide(),i.find(".title-result h2 .text-no-result").show(),i.find(".title-result h2 .text-result").hide(),i.find(".property-vertical-map-listing").hide(),i.find(".property-search-map-paging-wrap").hide();else{var o=e(".property-item",a.property_html),l=e(".property-search-map-paging-wrap",a.property_html);r.css("opacity",0),r.html(o),ERE.set_item_effect(o,"hide");var c=r.offset().top-30;e("html,body").animate({scrollTop:+c+"px"},500),r.css("opacity",1),r.imagesLoaded(function(){o=e(".property-item",r),ERE.set_item_effect(o,"show"),r.closest("div.list-property-result-ajax").find(".property-search-map-paging-wrap").html(l.html()),ERE_Property_Map_Search.property_map_paging(),ERE_Property_Map_Search.property_map_paging_control(),ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}),"0"!=o.length&&(i.find(".title-result h2 .number-result").html(a.total_post),i.find(".title-result h2 .number-result").show(),i.find(".title-result h2 .text-no-result").hide(),i.find(".title-result h2 .text-result").show(),i.find(".property-vertical-map-listing").show(),i.find(".property-search-map-paging-wrap").show())}}if(void 0!=s&&(s.css({height:"auto",width:"auto",padding:""}),s.button("reset")),n=!0,T=new google.maps.Map(document.getElementById(C),N),T.set("scrollwheel",!1),google.maps.event.trigger(T,"resize"),a.success===!0&&a.properties)var p=a.properties.length;if(1==p)var d=google.maps.event.addListener(T,"bounds_changed",function(e){this.setZoom(parseInt(z)),google.maps.event.removeListener(d)});if(""!==D){var _=JSON.parse(D);T.setOptions({styles:_})}var h=new google.maps.LatLng("","");if(T.setCenter(h),T.setZoom(parseInt(z)),google.maps.event.addListener(T,"tilesloaded",function(){e("#ere-map-loading").fadeOut()}),a.success===!0){for(var m=0;m<O.length;m++)O[m].setMap(null);O=[],G(a.properties,T),T.fitBounds(O.reduce(function(e,a){return e.extend(a.getPosition())},new google.maps.LatLngBounds)),google.maps.event.trigger(T,"resize"),"1"==q&&(I=new (T,O,{gridSize:60,styles:[{url:B,width:48,height:48,textColor:"#fff"}]}))}else L.empty().html('<div class="map-notfound">'+H+"</div>");L.closest("div.ere-search-map-properties").find("#ere-map-loading").fadeOut("slow")},error:function(){L.closest("div.ere-search-map-properties").find("#ere-map-loading").fadeOut("slow"),void 0!=s&&(s.css({height:"auto",width:"auto",padding:""}),s.button("reset")),n=!0}})}},e(document).ready(function(){ERE_Property_Map_Search.init()}),e(window).resize(function(){ERE_Property_Map_Search.full_screen()}),e(window).on("orientationchange",function(){ERE_Property_Map_Search.full_screen()}),e("body").keydown(function(a){return 35==a.which||34==a.which?(e(".col-scroll-vertical").animate({scrollTop:e(".col-scroll-vertical-inner").height()},"slow"),!1):36==a.which||33==a.which?(e(".col-scroll-vertical").animate({scrollTop:0},"slow"),!1):void 0})}(jQuery);